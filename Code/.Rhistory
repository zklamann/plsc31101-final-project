tm_bubbles("ve_part",
col = "blue",
scale = 3,
alpha = .4,
border.col = "black",
title.size = "Participants in violent events") +
tm_facets(along = "ve_date", free.coords = FALSE, as.layers = T, scale.factor = 1)+
tm_credits(violent_events$vlnt___, position = c("center", "top"), size = 1)+
tm_layout(inner.margins = 10)
#Now we try to get the animation working
tm_shape(map1919_no_borders) +
tm_fill("skyblue") +
tm_layout(frame = F,
title = "Major Violent Events of the Weimar Republic",
title.position = c("left", "top"),
title.bg.color = "gray80",
title.bg.alpha = .5,
bg.color = "gray80",
legend.outside = T,
legend.outside.position = "bottom") +
tm_shape(violent_events) +
tm_bubbles("ve_part",
col = "blue",
scale = 3,
alpha = .4,
border.col = "black",
title.size = "Participants in violent events") +
tm_facets(along = "ve_date", free.coords = FALSE, as.layers = T, scale.factor = 1)+
tm_credits(violent_events$vlnt___, position = c("center", "top"), size = 1)+
tm_layout(inner.margins = 2)
#Now we try to get the animation working
tm_shape(map1919_no_borders) +
tm_fill("skyblue") +
tm_layout(frame = F,
title = "Major Violent Events of the Weimar Republic",
title.position = c("left", "top"),
title.bg.color = "gray80",
title.bg.alpha = .5,
bg.color = "gray80",
legend.outside = T,
legend.outside.position = "bottom") +
tm_shape(violent_events) +
tm_bubbles("ve_part",
col = "blue",
scale = 3,
alpha = .4,
border.col = "black",
title.size = "Participants in violent events") +
tm_facets(along = "ve_date", free.coords = FALSE, as.layers = T, scale.factor = 1)+
tm_credits(violent_events$vlnt___, position = c("center", "top"), size = 1)+
tm_layout(inner.margins = .5)
?inner.margins
#Now we try to get the animation working
tm_shape(map1919_no_borders) +
tm_fill("skyblue") +
tm_layout(frame = F,
title = "Major Violent Events of the Weimar Republic",
title.position = c("left", "top"),
title.bg.color = "gray80",
title.bg.alpha = .5,
bg.color = "gray80",
legend.outside = T,
legend.outside.position = "bottom") +
tm_shape(violent_events) +
tm_bubbles("ve_part",
col = "blue",
scale = 3,
alpha = .4,
border.col = "black",
title.size = "Participants in violent events") +
tm_facets(along = "ve_date", free.coords = FALSE, as.layers = T, scale.factor = 1)+
tm_credits(violent_events$vlnt___, position = c("center", "top"), size = 1)+
tm_layout(inner.margins = .03)
#Now we try to get the animation working
tm_shape(map1919_no_borders) +
tm_fill("skyblue") +
tm_layout(frame = F,
title = "Major Violent Events of the Weimar Republic",
title.position = c("left", "top"),
title.bg.color = "gray80",
title.bg.alpha = .5,
bg.color = "gray80",
legend.outside = T,
legend.outside.position = "bottom") +
tm_shape(violent_events) +
tm_bubbles("ve_part",
col = "blue",
scale = 3,
alpha = .4,
border.col = "black",
title.size = "Participants in violent events") +
tm_facets(along = "ve_date", free.coords = FALSE, as.layers = T, scale.factor = 1)+
tm_credits(violent_events$vlnt___, position = c("center", "top"), size = 1)+
tm_layout(inner.margins = .09)
#Now we try to get the animation working
tm_shape(map1919_no_borders) +
tm_fill("skyblue") +
tm_layout(frame = F,
title = "Major Violent Events of the Weimar Republic",
title.position = c("left", "top"),
title.bg.color = "gray80",
title.bg.alpha = .5,
bg.color = "gray80",
legend.outside = T,
legend.outside.position = "bottom") +
tm_shape(violent_events) +
tm_bubbles("ve_part",
col = "blue",
scale = 3,
alpha = .4,
border.col = "black",
title.size = "Participants in violent events") +
tm_facets(along = "ve_date", free.coords = FALSE, as.layers = T, scale.factor = 1)+
tm_credits(violent_events$vlnt___, position = c("center", "top"), size = 1)+
tm_layout(inner.margins = .1)
#Now we try to get the animation working
tm_shape(map1919_no_borders) +
tm_fill("skyblue") +
tm_layout(frame = F,
title = "Major Violent Events of the Weimar Republic",
title.position = c("left", "top"),
title.bg.color = "gray80",
title.bg.alpha = .5,
bg.color = "gray80",
legend.outside = T,
legend.outside.position = "bottom") +
tm_shape(violent_events) +
tm_bubbles("ve_part",
col = "blue",
scale = 3,
alpha = .4,
border.col = "black",
title.size = "Participants in violent events") +
tm_facets(along = "ve_date", free.coords = FALSE, as.layers = T, scale.factor = 1)+
tm_credits(violent_events$vlnt___, position = c("center", "top"), size = 1)+
tm_layout(inner.margins = .3)
#Now we try to get the animation working
tm_shape(map1919_no_borders) +
tm_fill("skyblue") +
tm_layout(frame = F,
title = "Major Violent Events of the Weimar Republic",
title.position = c("left", "top"),
title.bg.color = "gray80",
title.bg.alpha = .5,
bg.color = "gray80",
legend.outside = T,
legend.outside.position = "bottom") +
tm_shape(violent_events) +
tm_bubbles("ve_part",
col = "blue",
scale = 3,
alpha = .4,
border.col = "black",
title.size = "Participants in violent events") +
tm_facets(along = "ve_date", free.coords = FALSE, as.layers = T, scale.factor = 1)+
tm_credits(violent_events$vlnt___, position = c("center", "top"), size = 1)+
tm_layout(inner.margins = .2)
#Now we try to get the animation working
tm_shape(map1919_no_borders) +
tm_fill("skyblue") +
tm_layout(frame = F,
title = "Major Violent Events of the Weimar Republic",
title.position = c("left", "top"),
title.bg.color = "gray80",
title.bg.alpha = .5,
bg.color = "gray80",
legend.outside = T,
legend.outside.position = "bottom") +
tm_shape(violent_events) +
tm_bubbles("ve_part",
col = "blue",
scale = 3,
alpha = .4,
border.col = "black",
title.size = "Participants in violent events") +
tm_facets(along = "ve_date", free.coords = FALSE, as.layers = T, scale.factor = 1)+
tm_credits(violent_events$vlnt___, position = c("center", "top"), size = 1)+
tm_layout(inner.margins = .1)
#Now we try to get the animation working
map1919_animation <- tm_shape(map1919_no_borders) +
tm_fill("skyblue") +
tm_layout(frame = F,
title = "Major Violent Events of the Weimar Republic",
title.position = c("left", "top"),
title.bg.color = "gray80",
title.bg.alpha = .5,
bg.color = "gray80",
legend.outside = T,
legend.outside.position = "bottom") +
tm_shape(violent_events) +
tm_bubbles("ve_part",
col = "blue",
scale = 3,
alpha = .4,
border.col = "black",
title.size = "Participants in violent events") +
tm_facets(along = "ve_date", free.coords = FALSE, as.layers = T, scale.factor = 1)+
tm_credits(violent_events$vlnt___, position = c("center", "top"), size = 1) +
tm_layout(inner.margins = .1)
tmap_animation(map1919_animation, file = "map1919_animation.gif", delay = 250, restart.delay = 500, loop = T, width = 2000)
#Now we try to get the animation working
map1919_animation <- tm_shape(map1919_no_borders) +
tm_fill("skyblue") +
tm_layout(frame = F,
title = "Major Violent Events of the Weimar Republic",
title.position = c("left", "top"),
title.bg.color = "gray80",
title.bg.alpha = .5,
bg.color = "gray80",
legend.outside = T,
legend.outside.position = "bottom") +
tm_shape(violent_events) +
tm_bubbles("ve_part",
col = "blue",
scale = 3,
alpha = .4,
border.col = "black",
title.size = "Participants in violent events") +
tm_facets(along = "ve_date", free.coords = FALSE, as.layers = T, scale.factor = 1)+
tm_credits(violent_events$vlnt___, position = c("center", "top"), size = 1) +
tm_layout(inner.margins = .15)
tmap_animation(map1919_animation, file = "map1919_animation.gif", delay = 250, restart.delay = 500, loop = T, width = 2000)
#Set up this animation
tm_shape(raster_berlin) +
tm_rgb() +
tm_layout(frame = F,
title = "Spartacist Uprising",
title.position = c("left", "top"),
title.bg.color = "gray80",
title.bg.alpha = .5,
bg.color = "gray80",
legend.outside = T,
legend.outside.position = "bottom") +
tm_shape(ve_berlin) +
tm_bubbles("ve_part",
col = "blue",
scale = 5,
alpha = .4,
border.col = "black",
title.size = "Participants in violent events")
#Set up this animation
tm_shape(raster_berlin) +
tm_rgb() +
tm_layout(frame = F,
title = "Spartacist Uprising",
title.position = c("left", "top"),
title.bg.color = "gray80",
title.bg.alpha = .5,
bg.color = "gray80",
legend.outside = T,
legend.outside.position = "bottom") +
tm_shape(ve_berlin) +
tm_bubbles("ve_part",
col = "blue",
scale = 5,
alpha = .4,
border.col = "black",
title.size = "Participants in violent events") +
tm_layout(legend.outside.size = 1)
#Set up this animation
tm_shape(raster_berlin) +
tm_rgb() +
tm_layout(frame = F,
title = "Spartacist Uprising",
title.position = c("left", "top"),
title.bg.color = "gray80",
title.bg.alpha = .5,
bg.color = "gray80",
legend.outside = T,
legend.outside.position = "bottom") +
tm_shape(ve_berlin) +
tm_bubbles("ve_part",
col = "blue",
scale = 5,
alpha = .4,
border.col = "black",
title.size = "Participants in violent events") +
tm_layout(legend.outside.size = .2)
#Set up this animation
tm_shape(raster_berlin) +
tm_rgb() +
tm_layout(frame = F,
title = "Spartacist Uprising",
title.position = c("left", "top"),
title.bg.color = "gray80",
title.bg.alpha = .5,
bg.color = "gray80",
legend.outside = T,
legend.outside.position = "bottom") +
tm_shape(ve_berlin) +
tm_bubbles("ve_part",
col = "blue",
scale = 5,
alpha = .4,
border.col = "black",
title.size = "Participants in violent events") +
tm_layout(legend.outside.size = .2, legend.height = .2 )
#Set up this animation
Berlin_map <- tm_shape(raster_berlin) +
tm_rgb() +
tm_layout(frame = F,
title = "Spartacist Uprising",
title.position = c("left", "top"),
title.bg.color = "gray80",
title.bg.alpha = .5,
bg.color = "gray80",
legend.outside = T,
legend.outside.position = "bottom") +
tm_shape(ve_berlin) +
tm_bubbles("ve_part",
col = "blue",
scale = 5,
alpha = .4,
border.col = "black",
title.size = "Participants in violent events")
tmap_animation(berlin_animation, file = "../visualizations/berlin_animation.gif", delay = 150, restart.delay = 3000, loop = T, width = 2000)
save_tmap(tm = Berlin_map, filename ="../visualizations/berlin_map.jpeg", width = 20, units = "in", dpi = 250)
tmap_save(tm = Berlin_map, filename ="../visualizations/berlin_map.jpeg", width = 20, units = "in", dpi = 250)
tmap_animation(map1919_animation, file = "../visualizations/map1919_animation.gif", delay = 250, restart.delay = 500, loop = T, width = 20, units = "in")
tmap_animation(map1919_animation, file = "../visualizations/map1919_animation.gif", delay = 250, restart.delay = 500, loop = T, width = 2000)
library(rgdal)
library(sp)
library(spatial)
library(raster)
#For the first task, we need a map of Germany and a map of the major violent events
library(sf)
source('C:/Users/Zachary Klamann/Desktop/R/Rochelle-Class-Project/Code/02_cleaning_merging_t1.R', echo=TRUE)
#For the first task, we need a map of Germany and a map of the major violent events
library(sf)
library(tidyr)
library(dplyr)
library(foreign)
library(tidyverse)
library(sp)
library(raster)
library(rgdal)
library(stringr)
library(maptools)
#For this map set, let's use a shapefile based on statistical units from the German Empire
#Statistical Office in 1919. We need the historical outline because borders have changed a lot.
map1919 <- readOGR(dsn = "../Data/spatial_data/mosaic_data_1931set/German_Empire_1919_Stat_v.1.0.shp")
#Now we need our violent events. I've created a .csv file in excel of the 16 largest events from the onset
#of the revolution in November 1918 to the Beer Hall Putsch in 1923 in Munich, so now I'm going to load that up
violent_events <- read.csv("../Data/spatial_data/Original datasets/violent_events.csv")
#Let's take a look at the structure of this:
str(violent_events)
#Needs to be transformed to a SPDF so it can be plotted
coordinates(violent_events) <- c("POINT_X", "POINT_Y")
#Okay, so if we're going to merge these two datasets, we'll need to have the same projection so the coordinates are mutually intelligible.
proj4string(violent_events)
proj4string(map1919)
#So, our violent events dataframe doesn't have a CRS because I didn't assign it one, yet, but our other map
# is using the WSG84 projection; so let's give out violent events the same one
proj4string(violent_events) <-  CRS("+init=epsg:4326")
proj4string(violent_events)
#Still in the wrong zone of the UTM, though, so we need to transform to match
violent_events <- spTransform(violent_events, proj4string(map1919))
#let's check
proj4string(violent_events)
proj4string(map1919)
#let's check the ranges
bbox(violent_events)
bbox(map1919)
#so something has gone wrong. Let's troubleshoot here
violent_events <- read.csv("../Data/spatial_data/Original datasets/violent_events.csv")
proj4string(map1919)
coordinates(violent_events) <- c("POINT_Y", "POINT_X")
projection(violent_events) <- "+init=epsg:4326"
violent_events <- spTransform(violent_events, CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"))
map1919 <- spTransform(map1919, CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"))
bbox(violent_events)
bbox(map1919)
plot(map1919)
plot(violent_events, add = T, col = "red")
#SUCCESS! They now map onto the same space and look decently alright!
#Let's remove the internal borders for some clarity on the map itself.
map1919_no_borders <- ms_dissolve(map1919)
#Need to reclassify some of the violent_events SPDF to make the dates column dates and the ve_parts column as numeric
violent_events$ve_date <- mdy(violent_events$ve_date)
violent_events$ve_part <- as.character(violent_events$ve_part)
violent_events$ve_part <- as.numeric(violent_events$ve_part)
#Time to write these as .shp files
writeOGR(obj = violent_events, dsn = "../Data/spatial_data/violent_events/violent_events.shp", layer = "ve", driver = "ESRI Shapefile")
writeOGR(obj = map1919_no_borders, dsn = "../Data/spatial_data/map1919/map1919_no_borders.shp", layer = "map1919_no_borders", driver = "ESRI Shapefile")
writeOGR(obj = map1919, dsn = "../Data/spatial_data/map1919/map1919.shp", layer = "map1919", driver = "ESRI Shapefile")
#For this map set, let's use a shapefile based on statistical units from the German Empire
#Statistical Office in 1919. We need the historical outline because borders have changed a lot.
map1919 <- readOGR(dsn = "../Data/spatial_data/mosaic_data_1931set/German_Empire_1919_Stat_v.1.0.shp")
#Now we need our violent events. I've created a .csv file in excel of the 16 largest events from the onset
#of the revolution in November 1918 to the Beer Hall Putsch in 1923 in Munich, so now I'm going to load that up
violent_events <- read.csv("../Data/spatial_data/Original datasets/violent_events.csv")
#Let's take a look at the structure of this:
str(violent_events)
#Needs to be transformed to a SPDF so it can be plotted
coordinates(violent_events) <- c("POINT_X", "POINT_Y")
#Okay, so if we're going to merge these two datasets, we'll need to have the same projection so the coordinates are mutually intelligible.
proj4string(violent_events)
proj4string(map1919)
#So, our violent events dataframe doesn't have a CRS because I didn't assign it one, yet, but our other map
# is using the WSG84 projection; so let's give out violent events the same one
proj4string(violent_events) <-  CRS("+init=epsg:4326")
proj4string(violent_events)
#Still in the wrong zone of the UTM, though, so we need to transform to match
violent_events <- spTransform(violent_events, proj4string(map1919))
#let's check
proj4string(violent_events)
proj4string(map1919)
#let's check the ranges
bbox(violent_events)
bbox(map1919)
#so something has gone wrong. Let's troubleshoot here
violent_events <- read.csv("../Data/spatial_data/Original datasets/violent_events.csv")
proj4string(map1919)
coordinates(violent_events) <- c("POINT_Y", "POINT_X")
projection(violent_events) <- "+init=epsg:4326"
violent_events <- spTransform(violent_events, CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"))
map1919 <- spTransform(map1919, CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"))
bbox(violent_events)
bbox(map1919)
plot(map1919)
plot(violent_events, add = T, col = "red")
#Let's remove the internal borders for some clarity on the map itself.
map1919_no_borders <- ms_dissolve(map1919)
library(rmapshaper)
#Let's remove the internal borders for some clarity on the map itself.
map1919_no_borders <- ms_dissolve(map1919)
#Need to reclassify some of the violent_events SPDF to make the dates column dates and the ve_parts column as numeric
violent_events$ve_date <- mdy(violent_events$ve_date)
library(lubridate)
#Need to reclassify some of the violent_events SPDF to make the dates column dates and the ve_parts column as numeric
violent_events$ve_date <- mdy(violent_events$ve_date)
violent_events$ve_part <- as.character(violent_events$ve_part)
violent_events$ve_part <- as.numeric(violent_events$ve_part)
#Time to write these as .shp files
writeOGR(obj = violent_events, dsn = "../Data/spatial_data/violent_events/violent_events.shp", layer = "ve", driver = "ESRI Shapefile")
writeOGR(obj = map1919_no_borders, dsn = "../Data/spatial_data/map1919/map1919_no_borders.shp", layer = "map1919_no_borders", driver = "ESRI Shapefile")
writeOGR(obj = map1919, dsn = "../Data/spatial_data/map1919/map1919.shp", layer = "map1919", driver = "ESRI Shapefile")
#Second task, we need a map of Berlin and point data on the major violent events in Berlin in January 1919
library(sf)
library(tidyr)
library(dplyr)
library(foreign)
library(tidyverse)
library(sp)
library(raster)
library(rgdal)
library(stringr)
library(maptools)
library(lubridate)
raster_berlin <- stack("../Data/spatial_data/berlin_geotiff.tiff")
#let's plot it to take a look
plotRGB(raster_berlin)
#We now need a SPDF for the location of violent events during the January Uprising
violent_events_berlin <- read.csv("../Data/spatial_data/Original datasets/violent_events_spart.csv")
coordinates(violent_events_berlin) <- c("POINT_Y", "POINT_X")
projection(violent_events_berlin) <- "+init=epsg:4326"
#We need to get these in the same CRS
crs(raster_berlin)
violent_events_berlin <- spTransform(violent_events_berlin, crs("+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"))
bbox(violent_events_berlin)
extent(raster_berlin)
#We should now be able to plot them simultaneously
plotRGB(raster_berlin)
plot(violent_events_berlin, add = T, lwd = 2)
#Need to clean up the data-types, as well
violent_events_berlin$ve_date <- mdy(violent_events_berlin$ve_date)
violent_events_berlin$ve_part <- as.numeric(violent_events_berlin$ve_part)
#Write these files
writeOGR(obj = violent_events_berlin, dsn = "../Data/spatial_data/violent_events_Berlin/violent_events_berlin.shp", layer = "ve_berlin", driver = "ESRI Shapefile")
#load some packages
library(sp)
library(maps)
library(rmapshaper)
library(magick)
library(tmap)
library(animation)
library(rgdal)
library(raster)
#For task 1
#Need to read in the files
map1919 <- readOGR(dsn = "../Data/spatial_data/map1919/map1919.shp")
violent_events <- readOGR(dsn = "../Data/spatial_data/violent_events/violent_events.shp")
#Clean up map1919 a bit and check everything is working
map1919_no_borders <- ms_dissolve(map1919)
plot(map1919_no_borders)
plot(violent_events, add = T, col = "red", lwd = 10)
violent_events$vlnt___<- as.character(violent_events$vlnt___)
#Now we try to get the animation working
map1919_animation <- tm_shape(map1919_no_borders) +
tm_fill("skyblue") +
tm_layout(frame = F,
title = "Major Violent Events of the Weimar Republic",
title.position = c("left", "top"),
title.bg.color = "gray80",
title.bg.alpha = .5,
bg.color = "gray80",
legend.outside = T,
legend.outside.position = "bottom") +
tm_shape(violent_events) +
tm_bubbles("ve_part",
col = "blue",
scale = 3,
alpha = .4,
border.col = "black",
title.size = "Participants in violent events") +
tm_facets(along = "ve_date", free.coords = FALSE, as.layers = T, scale.factor = 1)+
tm_credits(violent_events$vlnt___, position = c("center", "top"), size = 1) +
tm_layout(inner.margins = .15)
getwd()
getwd()
getwd()
getwd()
